# Kamal 2 production configuration
# Deploy with: kamal deploy -d production

builder:
  remote: true
  cache:
    type: registry
    image: onpequod/wordlegroup:build-cache

servers:
  web:
    hosts:
      - dockolith.pequod.dev
    options:
      add-host: host.docker.internal:host-gateway
  job:
    hosts:
      - dockolith.pequod.dev
    cmd: php artisan horizon
    options:
      add-host: host.docker.internal:host-gateway

proxy:
  ssl: true
  host: wordlegroup.com
  app_port: 80
  healthcheck:
    path: /health
    interval: 5
    timeout: 30

env:
  clear:
    APP_NAME: "Wordle Group"
    APP_ENV: production
    APP_DEBUG: "false"
    APP_URL: https://wordlegroup.com
    LOG_CHANNEL: stack
    LOG_LEVEL: error
    DB_CONNECTION: mysql
    DB_HOST: host.docker.internal
    DB_PORT: 3306
    DB_DATABASE: wordlegroup_production
    REDIS_HOST: host.docker.internal
    REDIS_PORT: 6379
    CACHE_STORE: redis
    SESSION_DRIVER: redis
    SESSION_LIFETIME: 120
    QUEUE_CONNECTION: redis
    BROADCAST_DRIVER: log
    FILESYSTEM_DISK: local
    MAIL_MAILER: ses
    MAIL_FROM_ADDRESS: scores@wordlegroup.com
    MAIL_FROM_NAME: "Wordle Group"
    AWS_DEFAULT_REGION: us-east-1
    SENTRY_TRACES_SAMPLE_RATE: 0.05
    SENTRY_LARAVEL_DSN: https://b4d5fcf4d3a742bc99f309c03ec65cc1@o1162154.ingest.sentry.io/6249034
  secret:
    - APP_KEY
    - DB_USERNAME
    - DB_PASSWORD
    - REDIS_PASSWORD
    - AWS_ACCESS_KEY_ID
    - AWS_SECRET_ACCESS_KEY

volumes:
  - /var/data/wordle-group/storage:/var/www/html/storage
